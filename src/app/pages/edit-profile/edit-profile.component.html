<div class="edit-profile-container">
  <div class="header">
    <button class="back-btn" (click)="goBack()">
      <i class="fas fa-arrow-left"></i> Back
    </button>
    <h1>Edit Profile</h1>
  </div>

  <div class="content">
    <!-- Profile Information Form -->
    <div class="form-section">
      <h2>Profile Information</h2>
      <form [formGroup]="profileForm" (ngSubmit)="onSubmitProfile()" class="profile-form">
        <div class="form-group">
          <label for="fullName">Full Name</label>
          <input 
            type="text" 
            id="fullName" 
            formControlName="fullName" 
            placeholder="Enter your full name"
            [class.error]="profileForm.get('fullName')?.invalid && profileForm.get('fullName')?.touched"
          >
          <div class="error-message" *ngIf="getProfileErrorMessage('fullName')">
            {{ getProfileErrorMessage('fullName') }}
          </div>
        </div>

        <div class="form-group">
          <label for="email">Email</label>
          <input 
            type="email" 
            id="email" 
            formControlName="email" 
            placeholder="Enter your email"
            [class.error]="profileForm.get('email')?.invalid && profileForm.get('email')?.touched"
          >
          <div class="error-message" *ngIf="getProfileErrorMessage('email')">
            {{ getProfileErrorMessage('email') }}
          </div>
        </div>

        <div class="form-actions">
          <button 
            type="submit" 
            class="btn btn-primary" 
            [disabled]="profileForm.invalid || isLoading"
          >
            <span *ngIf="isLoading" class="spinner"></span>
            {{ isLoading ? 'Updating...' : 'Update Profile' }}
          </button>
        </div>

        <div class="message" *ngIf="profileMessage" [class.success]="profileMessage.includes('successfully')" [class.error]="!profileMessage.includes('successfully')">
          {{ profileMessage }}
        </div>
      </form>
    </div>

    <!-- Password Change Form -->
    <div class="form-section">
      <div class="section-header">
        <h2>Change Password</h2>
        <button 
          type="button" 
          class="btn btn-secondary" 
          (click)="togglePasswordForm()"
        >
          {{ showPasswordForm ? 'Cancel' : 'Change Password' }}
        </button>
      </div>

      <form 
        *ngIf="showPasswordForm" 
        [formGroup]="passwordForm" 
        (ngSubmit)="onSubmitPassword()" 
        class="password-form"
      >
        <div class="form-group">
          <label for="currentPassword">Current Password</label>
          <input 
            type="password" 
            id="currentPassword" 
            formControlName="currentPassword" 
            placeholder="Enter current password"
            [class.error]="passwordForm.get('currentPassword')?.invalid && passwordForm.get('currentPassword')?.touched"
          >
          <div class="error-message" *ngIf="getPasswordErrorMessage('currentPassword')">
            {{ getPasswordErrorMessage('currentPassword') }}
          </div>
        </div>

        <div class="form-group">
          <label for="newPassword">New Password</label>
          <input 
            type="password" 
            id="newPassword" 
            formControlName="newPassword" 
            placeholder="Enter new password"
            [class.error]="passwordForm.get('newPassword')?.invalid && passwordForm.get('newPassword')?.touched"
          >
          <div class="error-message" *ngIf="getPasswordErrorMessage('newPassword')">
            {{ getPasswordErrorMessage('newPassword') }}
          </div>
        </div>

        <div class="form-group">
          <label for="confirmPassword">Confirm New Password</label>
          <input 
            type="password" 
            id="confirmPassword" 
            formControlName="confirmPassword" 
            placeholder="Confirm new password"
            [class.error]="passwordForm.get('confirmPassword')?.invalid && passwordForm.get('confirmPassword')?.touched"
          >
          <div class="error-message" *ngIf="passwordForm.get('confirmPassword')?.errors?.['required'] && passwordForm.get('confirmPassword')?.touched">
            Confirm password is required
          </div>
          <div class="error-message" *ngIf="passwordForm.errors?.['passwordMismatch'] && passwordForm.get('confirmPassword')?.touched">
            Passwords do not match
          </div>
        </div>

        <div class="form-actions">
          <button 
            type="submit" 
            class="btn btn-primary" 
            [disabled]="passwordForm.invalid || isLoading"
          >
            <span *ngIf="isLoading" class="spinner"></span>
            {{ isLoading ? 'Changing Password...' : 'Change Password' }}
          </button>
        </div>

        <div class="message" *ngIf="passwordMessage" [class.success]="passwordMessage.includes('successfully')" [class.error]="!passwordMessage.includes('successfully')">
          {{ passwordMessage }}
        </div>
      </form>
    </div>

    <!-- Current User Info -->
    <div class="user-info">
      <h3>Current Information</h3>
      <div class="info-grid">
        <div class="info-item">
          <span class="label">Name:</span>
          <span class="value">{{ currentUser?.name }}</span>
        </div>
        <div class="info-item">
          <span class="label">Email:</span>
          <span class="value">{{ currentUser?.email }}</span>
        </div>
        <div class="info-item">
          <span class="label">Role:</span>
          <span class="value">{{ currentUser?.role }}</span>
        </div>
      </div>
    </div>
  </div>
</div>
