<div class="container">
  <!-- Page Header -->
  <div class="page-header">
    <h1>Discover Our Products</h1>
    <p>Explore our amazing collection of high-quality products</p>
  </div>

  <!-- Search and Filter Section -->
  <div class="filters-section">
    <div class="search-container">
      <mat-form-field appearance="outline" class="search-field">
        <mat-label>Search products...</mat-label>
        <input
          matInput
          [(ngModel)]="searchTerm"
          (ngModelChange)="onSearchChange()"
          placeholder="Search by name or description..."
        />
        <mat-icon matSuffix>search</mat-icon>
      </mat-form-field>
    </div>

    <div class="category-filter">
      <mat-form-field appearance="outline">
        <mat-label>Category</mat-label>
        <mat-select [(value)]="categoryFilter" (selectionChange)="onCategoryChange($event)">
          <mat-option value="">All Categories</mat-option>
          <mat-option *ngFor="let category of categories" [value]="category.id">
            {{ category.name }}
          </mat-option>
        </mat-select>
      </mat-form-field>
    </div>

    <button
      mat-stroked-button
      (click)="clearFilters()"
      class="clear-filters-btn"
      *ngIf="searchTerm || categoryFilter">
      <mat-icon>clear</mat-icon>
      Clear Filters
    </button>
  </div>

  <!-- Results Summary -->
  <div class="results-summary" *ngIf="!isLoading && !error">
    <p>Showing {{ filteredProducts.length }} of {{ totalCount }} products</p>
  </div>

  <!-- Loading State -->
  <div *ngIf="isLoading" class="loading-container">
    <mat-spinner class="spinner"></mat-spinner>
    <p>Loading products...</p>
  </div>

  <!-- Error State -->
  <div *ngIf="error" class="error-container">
    <mat-icon class="error-icon">error</mat-icon>
    <h2 class="error-message">{{ error }}</h2>
    <p>Please try again later or contact support if the problem persists.</p>
    <button mat-raised-button color="primary" (click)="loadProducts()">
      <mat-icon>refresh</mat-icon>
      Retry
    </button>
  </div>

  <!-- Products Grid -->
  <div *ngIf="!isLoading && !error" class="products-grid">
    <mat-card *ngFor="let product of filteredProducts" class="product-card">
      <div class="product-image-container">
        <img
          mat-card-image
          class="product-image"
          [src]="product.imageUrl"
          [alt]="product.name"
          (error)="onImageError($event)"
          [routerLink]="['/product', product.id]"
        />
        <div class="product-overlay">
          <button mat-fab color="primary" class="view-details-btn" [routerLink]="['/product', product.id]">
            <mat-icon>visibility</mat-icon>
          </button>
        </div>
      </div>

      <mat-card-content class="product-content">
        <h3 class="product-name">
          <a [routerLink]="['/product', product.id]">{{ product.name }}</a>
        </h3>
        <p class="product-description">{{ product.description }}</p>
        <div class="product-price-section">
          <p class="product-price">${{ product.price | number:'1.2-2' }}</p>
          <div class="stock-info">
            <div class="stock-icon" [ngClass]="{
              'stock-high': product.stockQuantity > 50,
              'stock-medium': product.stockQuantity > 20 && product.stockQuantity <= 50,
              'stock-low': product.stockQuantity <= 20
            }"></div>
            <span class="stock-text">Stock: {{ product.stockQuantity }}</span>
          </div>
        </div>

        <div class="product-details">
          <span class="category-badge">{{ product.categoryName }}</span>
        </div>

        <button
          mat-raised-button
          color="primary"
          class="add-to-cart-btn"
          (click)="addToCart(product)"
          [disabled]="product.stockQuantity <= 0">
          <mat-icon>add_shopping_cart</mat-icon>
          {{ product.stockQuantity > 0 ? 'Add to Cart' : 'Out of Stock' }}
        </button>
      </mat-card-content>
    </mat-card>
  </div>

  <!-- No Results Message -->
  <div *ngIf="!isLoading && !error && filteredProducts.length === 0" class="no-results">
    <mat-icon class="no-results-icon">search_off</mat-icon>
    <h3>No products found</h3>
    <p>Try adjusting your search terms or filters</p>
    <button mat-raised-button color="primary" (click)="clearFilters()">
      <mat-icon>refresh</mat-icon>
      Clear Filters
    </button>
  </div>

  <!-- Pagination -->
  <div *ngIf="totalCount > pageSize && filteredProducts.length > 0" class="paginator-container">
    <mat-paginator
      [length]="totalCount"
      [pageSize]="pageSize"
      [pageIndex]="pageNumber - 1"
      [pageSizeOptions]="[5, 10, 25, 100]"
      (page)="onPageChange($event)">
    </mat-paginator>
  </div>
</div>
