<div class="container">
  <!-- Page Header -->
  <div class="page-header">
    <h1>Discover Our Products</h1>
    <p>Explore our amazing collection of high-quality products</p>
  </div>

  <!-- Search and Filter Section -->
  <div class="filters-section">
    <!-- Debug Info -->
    <div style="background: #f0f0f0; padding: 10px; margin-bottom: 15px; border-radius: 5px;">
      <strong>Debug Info:</strong> Categories loaded: {{ categories.length }} | 
      Categories: {{ categories.join(', ') }}
    </div>

    <!-- Test Material Components -->
    <div style="background: #e8f5e8; padding: 10px; margin-bottom: 15px; border-radius: 5px;">
      <strong>Material Components Test:</strong>
      <button mat-raised-button color="primary" style="margin-right: 10px;">Test Button</button>
      <mat-chip>Test Chip</mat-chip>
    </div>

    <!-- Search Bar -->
    <div class="search-container">
      <div class="search-field-simple">
        <input 
          type="text"
          [formControl]="searchControl"
          (input)="onSearchChange()"
          placeholder="Search products by name or description..."
          class="search-input">
        <span class="search-icon">üîç</span>
      </div>
    </div>

    <!-- Category Filters -->
    <div class="category-filters">
      <h3>Filter by Category ({{ categories.length }} available)</h3>
      <div class="category-chips">
        @for (category of categories; track category) {
          <button 
            [class.selected]="selectedCategories.includes(category)"
            (click)="toggleCategory(category)"
            class="category-chip-simple">
            {{ category }}
          </button>
        }
        @if (categories.length === 0) {
          <p style="color: #666; font-style: italic;">No categories available</p>
        }
      </div>
    </div>

    <!-- Clear Filters Button -->
    @if (searchControl.value || selectedCategories.length > 0) {
      <div class="clear-filters">
        <button 
          (click)="clearFilters()"
          class="clear-btn-simple">
          ‚úï Clear Filters
        </button>
      </div>
    }
  </div>
  
  <!-- Content Section -->
  @if (isLoading) {
    <!-- Loading State -->
    <div class="loading-container">
      <mat-spinner class="spinner"></mat-spinner>
    </div>
  } @else if (error) {
    <!-- Error State -->
    <div class="error-container">
      <h2 class="error-message">{{ error }}</h2>
      <p>Please try again later or contact support if the problem persists.</p>
    </div>
  } @else {
    <!-- Products Grid -->
    @if (paginatedProducts.length > 0) {
      <div class="products-grid">
        @for (product of paginatedProducts; track product.id) {
          <mat-card class="product-card">
            <!-- Product Image -->
            <img 
              mat-card-image 
              class="product-image"
              [src]="product.imageUrl" 
              [alt]="product.name"
              (error)="onImageError($event)">
            
            <!-- Product Content -->
            <mat-card-content class="product-content">
              <!-- Product Name -->
              <h3 class="product-name">{{ product.name }}</h3>
              
              <!-- Product Description -->
              <p class="product-description">{{ product.description }}</p>
              
              <!-- Product Price -->
              <p class="product-price">${{ product.price | number:'1.2-2' }}</p>
              
              <!-- Product Details -->
              <div class="product-details">
                <!-- Stock Information -->
                <div class="stock-info">
                  <div 
                    class="stock-icon"
                    [ngClass]="{
                      'stock-high': product.stockQuantity > 50,
                      'stock-medium': product.stockQuantity > 20 && product.stockQuantity <= 50,
                      'stock-low': product.stockQuantity <= 20
                    }">
                  </div>
                  <span>Stock: {{ product.stockQuantity }}</span>
                </div>
                
                <!-- Category Badge -->
                <span class="category-badge">{{ product.categoryName }}</span>
              </div>
              
              <!-- Add to Cart Button -->
              <button class="add-to-cart-btn">
                Add to Cart
              </button>
            </mat-card-content>
          </mat-card>
        }
      </div>
    } @else {
      <!-- No Results Message -->
      <div class="no-results">
        <div class="no-results-icon">üîç</div>
        <h3>No products found</h3>
        <p>Try adjusting your search criteria or filters to find what you're looking for.</p>
        <button 
          (click)="clearFilters()"
          class="clear-filters-btn-simple">
          Clear All Filters
        </button>
      </div>
    }
    
    <!-- Results Summary -->
    <div class="results-summary">
      <p>Showing {{ (pageNumber - 1) * pageSize + 1 }} - {{ Math.min(pageNumber * pageSize, totalCount) }} of {{ totalCount }} products</p>
    </div>

    <!-- Pagination -->
    @if (totalCount > pageSize) {
      <div class="paginator-container">
        <mat-paginator 
          [length]="totalCount"
          [pageSize]="pageSize"
          [pageIndex]="pageNumber - 1"
          [pageSizeOptions]="[5, 10, 25, 100]"
          (page)="onPageChange($event)">
        </mat-paginator>
      </div>
    }
  }
</div>